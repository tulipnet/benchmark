
var xmlURL="bwdet.xml";var SPEED_TEST_TIMEOUT=90;var speedTestTime=SPEED_TEST_TIMEOUT;var spWatchTimeOut=0;var BWDET_ST=0;var BWDET_RECORD_TYPE=0;var BWDET_PING=1;var BWDET_UL_SPEED=2;var BWDET_DL_SPEED=3;var BWDET_RECORD_TIME=4;var bwType=0;var MAX_SPEED_LIMIT=60;var MIN_SPEED_LIMIT=0.01;var HW_MAX_SPEED_LIMIT=100;function getBwRst(aryBw){var bwObj={qos_en:0,recPing:"",recUpload:"",recDownload:"",recDate:"",recType:NaN,st:99,tmpPing:"",tmpUpload:"",tmpDownload:""};if(aryBw){bwObj.qos_en=parseInt(aryBw[0],10);var tmp=aryBw[1].toString().split(";");if(tmp.length>1){bwObj.recType=parseInt(tmp[BWDET_RECORD_TYPE],10);bwObj.recPing=(bwObj.recType==1)?tmp[BWDET_PING]:"";bwObj.recUpload=tmp[BWDET_UL_SPEED];bwObj.recDownload=tmp[BWDET_DL_SPEED];bwObj.recDate=tmp[BWDET_RECORD_TIME];}
tmp=aryBw[2].toString().split(";");if(tmp.length>1){bwObj.st=parseInt(tmp[BWDET_ST],10);switch(bwObj.st){case 0:case 3:bwObj.tmpDownload=tmp[BWDET_DL_SPEED];case 2:bwObj.tmpUpload=tmp[BWDET_UL_SPEED];case 1:bwObj.tmpPing=tmp[BWDET_PING];default:}}}else{bwObj.qos_en=getCfgInt("qos_en");var objRec=getCfgAry("bwdet_rec");if(objRec&&objRec.length>1){bwObj.recType=parseInt(objRec[BWDET_RECORD_TYPE],10);bwObj.recPing=(bwObj.recType==1)?objRec[BWDET_PING]:"";bwObj.recUpload=(getCfgFloat("upload_speed")*getCfgInt("dl_bw_unit")/1000).toFixed(2);bwObj.recDownload=(getCfgFloat("download_speed")*getCfgInt("ul_bw_unit")/1000).toFixed(2);bwObj.recDate=objRec[BWDET_RECORD_TIME];}}
return bwObj;}
function setBwRst(bwObj){var bw_rec="";if(bwObj.qos_en==1){bw_rec+=bwType+";";bw_rec+=(bwType==1)?bwObj.tmpPing+";":";";bw_rec+=bwObj.tmpUpload+";";bw_rec+=bwObj.tmpDownload+";";dateObj=new Date();var dateTmp=dateObj.getFullYear()+"/"+(dateObj.getMonth()+1)+"/"+dateObj.getDate()+' '+dateObj.getHours()+':'+dateObj.getMinutes();bw_rec+=dateTmp;setCfg("bwdet_rec",bw_rec);var objCfgTmp=getCfgObj("bwdet_tmp");objCfgTmp.o="tmp";objCfgTmp.v="";setCfgObj("bwdet_tmp",objCfgTmp);setCfg("upload_speed",bwObj.tmpUpload*1000);setCfg("download_speed",bwObj.tmpDownload*1000);setCfg("ul_bw_unit",1);setCfg("dl_bw_unit",1);setCfg("qos_en",bwObj.qos_en);setCfg("bwdet_ctrl",0);}
else{setCfg("qos_en",bwObj.qos_en);}}<%CFG_MAP(qos_en,QOS_EN);%><%CFG_MAP(bwdet_ctrl,BWDET_CTRL);%><%CFG_MAP(bwdet_rec,BWDET_REC);%><%CFG_MAP(bwdet_tmp,STS_BWDET_TMP);%><%CFG_MAP(download_speed,QOS_DOWNSTREAM_SPEED);%><%CFG_MAP(dl_bw_unit,QOS_DOWNSTREAM_SPEED_UNIT);%><%CFG_MAP(upload_speed,QOS_UPSTREAM_SPEED);%><%CFG_MAP(ul_bw_unit,QOS_UPSTREAM_SPEED_UNIT);%>
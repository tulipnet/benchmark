<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"lang="en"> <![endif]--><!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"lang="en"> <![endif]--><!--[if IE 8]> <html class="no-js lt-ie9"lang="en"> <![endif]--><!--[if gt IE 8]><!--><html lang="en"class="gt-ie8"><!--<![endif]--><!--[if IE]><html xmlns="http://www.w3.org/1999/xhtml"xmlns:v><![endif]--><head><meta charset="utf-8"/><meta name="viewport"content="width=device-width"/><title></title> <link rel="icon"href="images/favicon/favicon.ico"><link rel="apple-touch-icon-precomposed"sizes="144x144"href="images/favicon/belkin_144.png"><link rel="apple-touch-icon-precomposed"sizes="114x114"href="images/favicon/belkin_114.png"><link rel="apple-touch-icon-precomposed"sizes="72x72"href="images/favicon/belkin_72.png"><link rel="apple-touch-icon-precomposed"href="images/favicon/belkin_57.png"><link rel="stylesheet"href="stylesheets/app.css?t=20140212"><!--[if lt IE 9]><link rel="stylesheet"href="stylesheets/ie.css"><![endif]--><!--[if IE]><?import namespace="v"implementation="#default#VML"?><![endif]--><script>var LangJ=["menulist","help","comm","nat_v"];var CGIs=["lan","natv"];</script><script src="javascripts/init.js"></script><script src="javascripts/jquery.min.js"></script><script src="javascripts/global.js"></script><script src="javascripts/app.js"></script><script src="javascripts/menu.js"></script></head><body style="display:none"id="mainbody"> <script><%CGI_INCLUDE(javascripts/main_header.js);%></script><script src="javascripts/nat.js"></script><script src="javascripts/routine.js"></script><div class="main container"> <div class="row"><div class="eight columns"><form class="nice"name="tF"method="post"action="/cgi-bin/setup_natv.exe"target="OUTfrm"><div class="row"> <div class="twelve columns"><br><br><p class=""> <span> <b><span tid="276"></span>&nbsp;</b> <span id="clr_vs_list"></span>&nbsp;&nbsp; <a href="#clear"class="nice radius small white button margin-rows"tid="411"onClick="return ClearEntry()"></a>&nbsp;&nbsp; </span> </p><p class=""> <div id="div_tb"> <table id="tb_vs_list"class="minimal nofirst"> <thead> <tr> <th></th> <th><b><font tid="374"></font></b></th> <th><b><font tid="278"></font></b></th> <th><b><font tid="279"></font></b></th> <th><b><font tid="280"></font></b></th> <th><b><font tid="281"></font></b></th> <th><b><font tid="282"></font></b></th> </tr> </thead> <tbody> <tr> <td colspan="7"></td> </tr> </tbody> </table> </div><div id="div_catch"></div> </p></div></div><br><a href="#save"class="nice radius large green button"tid="49"onClick="return evaltF()"id="dnsapply"></a></form></div><div class="sidebar four columns"> <div><h6><span tid="htPortForward"></span></h6> <p> <span tid="htPortForwardContent"></span> <span class="nub"></span></p> </div> </div></div> </div><script>/*JS_PACKER*/function f_Obj(name){return eval('document.tF.'+name);}
function f_Obj_v(name){var obj=eval('document.tF.'+name);if(obj){if(obj.type=="radio"||obj.type=="checkbox"){return(obj.checked)?obj.value:0;}else{return obj.value;}}else{return'';}}
function PushCatch(){var h=$I("div_tb").innerHTML.replace(/name=/ig,'test=');HiddenObject("tb_vs_list");$I("div_catch").innerHTML=h;}
function PopCatch(){$I("div_catch").innerHTML="";DisplayObject("tb_vs_list");}
function null_entry(idx){var chk=0;if(f_Obj_v("service_name"+idx)!='')chk++;if(f_Obj_v("lan_ip"+idx)!='')chk++;if(f_Obj_v("lan_port"+idx)!='')chk++;if(f_Obj_v("protocol"+idx)!=TCP)chk++;return((chk)?false:true);}
function clearFields(index){if(index<0&&index>VS_LIST_MAX)
return;SetFieldValue(f_Obj('enable'+index),0);SetFieldValue(f_Obj('lan_ip'+index),"");SetFieldValue(f_Obj('service_name'+index),"");SetFieldValue(f_Obj('protocol'+index),TCP);SetFieldValue(f_Obj('lan_port'+index),"");SetFieldValue(f_Obj('wan_port'+index),"");}
function ClearEntry(){var f=document.tF;var entry=getFieldValue(f.clear_entry_list);var idx=parseInt(entry,10)-1;if(entry=='all'){if(ConfirmM(907)){PushCatch();for(var i=0;i<VS_LIST_MAX;i++){clearFields(i);}
PopCatch();}}else{if(idx<GetEmptyEntry()){if(confirm(getLangM(906)+entry+"?")){PushCatch();for(var i=idx;i<VS_LIST_MAX-1;i++){copy_vs_cgi(i,i+1);}
clearFields(VS_LIST_MAX-1);PopCatch();}}}}
function en_entry(index){return f_Obj_v('enable'+index);}
function EmptyCount(){return(VS_LIST_MAX-GetEmptyEntry());}
function GetEmptyEntry(){var i=0;for(i=VS_LIST_MAX-1;i>=0;i--){if(!null_entry(i)){break;}}
if(i==VS_LIST_MAX)
AlertM(905);return(i+1);}
function copy_vs_cgi(dst,src){SetFieldValue(f_Obj('lan_ip'+dst),f_Obj_v('lan_ip'+src));SetFieldValue(f_Obj('service_name'+dst),f_Obj_v('service_name'+src));SetFieldValue(f_Obj('protocol'+dst),f_Obj_v('protocol'+src));SetFieldValue(f_Obj('lan_port'+dst),f_Obj_v('lan_port'+src));SetFieldValue(f_Obj('wan_port'+dst),f_Obj_v('wan_port'+src));SetFieldValue(f_Obj('enable'+dst),f_Obj_v('enable'+src));}
function isWanPortoverlay(proto,b_port,e_port,skip_idx)
{var chk_proto,chk_ports;var portrange=new PORT_RANGE();for(var i=0;i<skip_idx;i++){chk_ports=f_Obj_v("wan_port"+i);chk_proto=f_Obj_v("protocol"+i);if(!chk_proto)chk_proto=TCP;if(chk_proto!=proto){if((proto!=BOTH)&&(chk_proto!=BOTH))continue;}
portrange=parsePortValueRange(chk_ports);if(portrange==null)continue;if(((b_port>=portrange.b_port)&&(b_port<=portrange.e_port))||((e_port>=portrange.b_port)&&(e_port<=portrange.e_port))){return true;}
if(((b_port<=portrange.b_port)&&(portrange.b_port<=e_port))||((b_port<=portrange.e_port)&&(portrange.e_port<=e_port))){return true;}}
return false;}
function isLanPortoverlay(lastip,proto,b_port,e_port,skip_idx)
{var chk_proto,chk_ports,chk_ip;var portrange=new PORT_RANGE();for(var i=0;i<skip_idx;i++){chk_ports=f_Obj_v("lan_port"+i);chk_proto=f_Obj_v("protocol"+i);chk_ip=f_Obj_v("lan_ip"+i);if(lastip!=chk_ip)continue;if(!chk_proto)chk_proto=TCP;if(chk_proto!=proto){if((proto!=BOTH)&&(chk_proto!=BOTH))continue;}
portrange=parsePortValueRange(chk_ports);if(portrange==null)continue;if(((b_port>=portrange.b_port)&&(b_port<=portrange.e_port))||((e_port>=portrange.b_port)&&(e_port<=portrange.e_port))){return true;}}
return false;}
function VerifyVSEntry(index){var f=document.tF;var portrange=new PORT_RANGE();var i;var vs_en=0;var lan_ports='';var wan_ports='';var servname='';var wan_proto='';var priv_port;var priv_ip;var last_ip_oct;var lanip=getCfg("lan_ip").split(".");var lan_ip_prefix=lanip[0]+'.'+lanip[1]+'.'+lanip[2]+'.';if(index<0&&index>=VS_LIST_MAX)
return true;if(null_entry(index)&&!f_Obj_v('enable'+index)){setCfg("vs_lst"+(index+1),"");return true;}
vs_en=f_Obj_v("enable"+index);servname=f_Obj_v("service_name"+index);if(servname==''){alert("No "+(index+1)+'.'+getLangM(278)+' : '+getLangM(648)+'.');f_Obj("service_name"+index).focus();return false;}
wan_proto=f_Obj_v("protocol"+index);wan_ports=f_Obj_v("wan_port"+index);portrange=parsePortValueRange(wan_ports);if((portrange==null)){alert("No "+(index+1)+"."+getLangM(88));f_Obj("wan_port"+index).focus();return false;}
if((portrange.b_port<=0||portrange.b_port>65535)||(portrange.e_port<=0||portrange.e_port>65535)){alert("No "+(index+1)+"."+getLangM(132)+"\n"+getLangM(88));f_Obj("wan_port"+index).focus();return false;}
if(portrange.b_port>portrange.e_port){alert("No "+(index+1)+"."+getLangM(132)+"\n"+getLangM(88));f_Obj("wan_port"+index).focus();return false;}
if(isWanPortoverlay(wan_proto,portrange.b_port,portrange.e_port,index)==true)
{AlertM(2055);f_Obj("wan_port"+index).focus();return false;}
wan_ports=portrange.b_port+"-"+portrange.e_port;last_ip_oct=f_Obj_v("lan_ip"+index);if(!isInteger(last_ip_oct)||isNValidLastIP(last_ip_oct)||(last_ip_oct)==lanip[3]){alert("No"+(index+1)+". "+getLangM(1240));f_Obj("lan_ip"+index).focus();return false;}
priv_ip=lan_ip_prefix+last_ip_oct;lan_ports=f_Obj_v("lan_port"+index);portrange=parsePortValueRange(lan_ports);if((portrange==null)){alert("No "+(index+1)+"."+getLangM(133)+"\n"+getLangM(88));f_Obj("lan_port"+index).focus();return false;}
if((portrange.b_port<=0||portrange.b_port>65535)||(portrange.e_port<=0||portrange.e_port>65535))
{alert("No "+(index+1)+"."+getLangM(133)+"\n"+getLangM(88));f_Obj("lan_port"+index).focus();return false;}
if(portrange.b_port>portrange.e_port){alert("No"+(index+1)+"."+getLangM(132)+"\n"+getLangM(88));f_Obj("lan_port"+index).focus();return false;}
if(isLanPortoverlay(last_ip_oct,wan_proto,portrange.b_port,portrange.e_port,index)==true)
{AlertM(2056);f_Obj("lan_port"+index).focus();return false;}
lan_ports=portrange.b_port+"-"+portrange.e_port;var vs=getCfgAry("vs_lst"+(index+1),6);if(!vs)vs=[];vs[V_EN]=(vs_en==1)?"1":"0";vs[V_DESC]=servname;vs[V_WAN_PORTS]=wan_ports;vs[V_PROTO]=wan_proto;vs[V_LAN_IP]=priv_ip;vs[V_LAN_PORTS]=lan_ports;setCfgAry("vs_lst"+(index+1),vs);return true;}
function evaltF(){var chk=0;var f=document.tF;var vs;for(var i=0;i<VS_LIST_MAX;i++)
{if(!VerifyVSEntry(i))
return false;}
return subForm({frm:f,cmd:"VTS_CONF",wait:10});}
function init(){var h='';var f=document.tF;var lanip=getCfg("lan_ip").split(".");var vs_serv;h='<select name="clear_entry_list">';for(var i=1;i<=VS_LIST_MAX;i++){h+='<option value="'+i+'">'+i+'</option>';}
h+='<option value="all">'+getLangM(376)+'</option>'+'</select>';setIdVal("clr_vs_list",h);var rowcnt=0;var RowCell,c1,c2,c3,c4,c5,c6,c7;var key=0;var i,j,k;for(i=0;i<VS_LIST_MAX;i++){key=(i+1);c1=(i+1);c2='<input type="checkbox" class="margin-rows" name="enable'+i+'" value="1" NOCHECK="0">';c3='<input type="text" class="input-text xsmall" maxlength="40" name="service_name'+i+'" value="">';c4='<input type="text" class="input-text csmall" maxlength="40" name="wan_port'+i+'" value="">';c5='<select name="protocol'+i+'" class="input-text">'+'<option value="6">TCP</option>'+'<option value="17">UDP</option>'+'<option value="255">TCP&UDP</option>'+'</select>';c6='<nobr><span class="drop-ip">'+lanip[0]+'.'+lanip[1]+'.'+lanip[2]+'.<input type="text" class="input-text xsmall" maxlength="3" name="lan_ip'+i+'" value=""></span></nobr>';c7='<input type="text" class="input-text csmall" maxlength="40" name="lan_port'+i+'" value="">';RowCell=[[1,c1,{'class':'drop-ip middle','align':'center'}],[1,c2,{'class':'drop-ip middle','align':'center'}],[1,c3,{'class':'drop-ip middle'}],[1,c4,{'class':'drop-ip middle'}],[1,c5,{'class':'drop-ip middle','align':'center'}],[1,c6,{'class':'drop-ip middle'}],[1,c7,{'class':'drop-ip middle','align':'center'}],[null,null]];rowcnt+=Table_add_row("tb_vs_list",[[7,rowcnt,1],RowCell],0);vs_serv=getCfgAry("vs_lst"+(key),6);if(vs_serv){obj=eval('f.enable'+i);SetFieldValue(obj,(vs_serv[V_EN]=="1")?1:0);obj=eval('f.service_name'+i);SetFieldValue(obj,vs_serv[V_DESC]);if(vs_serv[V_WAN_PORTS]){port_rangs=vs_serv[V_WAN_PORTS].split(",");for(var j=0;j<port_rangs.length;j++){p_rang=port_rangs[j].split("-");obj=eval('f.wan_port'+i);if(p_rang[V_WAN_PORT_S]!=p_rang[V_WAN_PORT_E])
SetFieldValue(obj,p_rang[V_WAN_PORT_S]+"-"+p_rang[V_WAN_PORT_E]);else
SetFieldValue(obj,p_rang[V_WAN_PORT_S]);break;}}
obj=eval('f.protocol'+i);SetFieldValue(obj,vs_serv[V_PROTO]);obj=eval('f.lan_ip'+i);ip=vs_serv[V_LAN_IP].split(".");if((ip.length>=4)&&(ip[3]!="0"))
SetFieldValue(obj,ip[3]);if(vs_serv[V_LAN_PORTS]){port_rangs=vs_serv[V_LAN_PORTS].split(",");for(var j=0;j<port_rangs.length;j++){p_rang=port_rangs[j].split("-");obj=eval('f.lan_port'+i);if(p_rang[V_LAN_PORT_S]!=p_rang[V_LAN_PORT_E])
SetFieldValue(obj,p_rang[V_LAN_PORT_S]+"-"+p_rang[V_LAN_PORT_E]);else
SetFieldValue(obj,p_rang[V_LAN_PORT_S]);break;}}}else{obj=eval('f.wan_proto'+i);SetFieldValue(obj,"tcp+udp");}}
ShowNavMenu();}
/*END_JS_PACKER*/<%CGI_LOGIN_KEEP();%></script> <script><%CGI_INCLUDE(javascripts/main_footer.js);%></script>